<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<!--  jQuery Mobile 1.4.2 CDN -->
<!-- 		<link rel="stylesheet" href="../html5/jqm/1.4.2/css/themes/default/jquery.mobile-1.4.2.min.css" /> -->
<!-- 		<script src="../html5/jq/jquery-1.9.1.min.js"></script> -->
<!-- 		<script src="../html5/jqm/1.4.2/js/jquery.mobile-1.4.2.min.js"></script> -->
		
		<!--  jQuery Mobile 1.3.2 CDN -->
		<link rel="stylesheet" href="../html5/jqm/1.3.2/css/themes/default/jquery.mobile-1.3.2.min.css" />
		<script src="../html5/jq/jquery-1.9.1.min.js"></script>
		<script src="../html5/elastic-init-1.4.3.jsp"></script>
		<script src="../html5/elastic-util-1.5.js"></script>
		
		<!-- 
			jQuery mobile의 event 관련 초기화 코드는 항상 여기에 둔다. 
			즉, jquery.js와 jquery.mobile.js 사이. 
		-->
		<script>
			// Initialization Event
			$(document).on("mobileinit", function() {
				// 페이지 기본 애니메이션 변경
				$.mobile.defaultPageTransition = "flow";
				// 다이얼로그 기본 애니메이션 변경
				$.mobile.defaultDialogTransition = "turn";
				// ajax 사용 여부
				$.mobile.ajaxEnabled = true;
				
				/*
					터치 이벤트
					tap: 눌렀을 때
				 */
				 $(document).on("tap", "#btn", function(e) {
					    var postData = $("#form1").serializeArray();
					    var formURL = elastic_baseUrl() + "/main";//$("#form1").attr("action");
						$.ajax({
							// 접속할 페이지의 주소
					        url : formURL,
							// 전송타입(post, get)
					        type: "GET",
							// 수신 데이터 타입(text, html, xml, json)
							dataType: "html",
							// 데이터
					        data : postData,
							// 통신이 성공하면 호출되는 함수
							success: function(resData) {
								$('#result').html("<button onClick=\"$('#result').html('')\">Clear Result</button><xmp>" + resData + "</xmp>");
							},
							// 통신이 실패하면 호출되는 함수
							error: function(error) {
								$('#result').html("error: " + error.code);
							}
						})
						e.preventDefault(); //STOP default action
					    e.unbind(); //unbind. to stop multiple form submit.
					});
			});
		</script>
		
		<script src="../html5/jqm/1.3.2/js/jquery.mobile-1.3.2.min.js"></script>
</head>
<BODY>
	<div data-role="page">
		<div data-role="header">
			<h1>Resource Bundle</h1>
			<a href="javascript:window.history.go(-1)" data-theme="a" data-ajax="false">Home</a>
		</div>
		
		<div data-role="content">
		<UL>
			<LI><B>Java 프로그램 작성 :</B> sample.elasticservice.service.Sample12_ResourceBundle.java<BR>
				<textarea>
/**
 * <H3>o Required parameters</H3><BR>
 * <UL>
 *     <LI>lang: ex) "ko", "en</LI>
 *     <LI>resourceId: ex) "bundle.properties"</LI>
 *     <LI>propertyKey: ex) "hello"</LI>
 * </UL>
 * <P>
 * <H3>o URL example</H3><BR>
 * <UL>
 *     <LI>main?<BR>
 *     cmd=sample.elasticservice.service.Sample12_ResourceBundle&<BR>
 *     cmd.resType=json12&<BR>
 *     lang=ko&<BR>
 *     resourceId=bundle.properties&<BR>
 *     propertyKey=hello&<BR>
 *     COL_name=QTI Guy</LI>
 * </UL>
 * <P>
 * 
 * @author jakelee70
 * 
 */
public class Sample12_ResourceBundle implements ElasticService {
	private static final Logger LOG = Logger
			.getLogger(Sample12_ResourceBundle.class);

	public Object execute(ElasticRequest req, ElasticResponse res)
			throws Exception {

		String lang = (String) req.getParam("lang");
		String resourceId = (String) req.getParam("resourceId");
		String propertyKey = (String) req.getParam("propertyKey");

		Dataset reqDS = req.getDataset(0);
		Map reqColumns = reqDS.get(0);

		if (StringUtil.isEmpty(lang)) {
			XmlReader config = (XmlReader) BeanMgr.getInstance().get("config");
			lang = config.getText("/Config/lang");
		}

		FileResourceManager resourceMgr = (FileResourceManager) BeanMgr
				.getInstance().get("fileResourceMgr");
		ExProperties resource = (ExProperties) resourceMgr.getFileResource(
				lang, resourceId);

		// Respond to a client.
		Map resMap = new HashMap();
		resMap.put("value0", resource.getProperty(propertyKey));
		resMap.put("value1", resource.getProperty(propertyKey, "name", "Jake 1"));
		resMap.put("value2", resource.getProperty(propertyKey, new String[] { "name" }, new String[] { "Jake 2" }));
		resMap.put("value3", resource.getProperty(propertyKey, reqColumns));

		Dataset ds = new WebDataset(null);
		ds.add(resMap);

		ElasticParams resEP = new ElasticParams();
		resEP.setDataset(ds);

		return resEP;
	}
}</textarea>
			</LI>
			<P>
			<LI><B>사용자 정의 XML 파일 작성</B>/WEB-INF/elastic/sampleConfig.xml<BR>
				<textarea>
<?xml version="1.0" encoding="UTF-8"?>

<Config>
	<lang>en</lang>
</Config></textarea>
			</LI>
			<P>
			<LI><B>사용자 정의 XML 파일 등록: </B> /WEB-INF/elastic/bean-sample.xml<BR>
				<textarea>
<bean id="config" class="elastic.util.xml.XmlReader" singleton="true">
	<constructor-arg>
		<File>${current.dir}/sampleConfig.xml</File>
	</constructor-arg>
</bean>	</textarea>
			</LI>
			<P>
			<LI><B>Resource Bundle 파일 등록: </B> /WEB-INF/elastic/resource/ko/bundle.properties<BR>
				<textarea>
# encoding=UTF-8

hello=안녕하세요 ${NAME} ~^^</textarea>
			</LI>
			<P>
			<LI>
				<FORM METHOD="GET" ID="form1">
					<B>주소 :</B> <script>document.write(elastic_baseUrl())</script>/main<BR> 
					<div data-role="fieldcontain"> 
					?cmd=<INPUT TYPE=TEXT NAME='cmd' VALUE="sample.elasticservice.service.Sample12_ResourceBundle" SIZE="35"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&cmd.resType=<SELECT NAME="cmd.resType">
						<OPTION VALUE="ME20">MakeElastic(ME20)</OPTION>
						<OPTION VALUE="PlatformXml">XML</OPTION>
						<OPTION VALUE="PWPLUS10">PWPLUS10</OPTION>
						<OPTION VALUE="PWPLUS15">PWPLUS15</OPTION>
						<OPTION VALUE="JSON10">JSON10</OPTION>
						<OPTION VALUE="JSON11">JSON11</OPTION>
						<OPTION VALUE="JSON12" selected>JSON12</OPTION>
						<OPTION VALUE="CSV">엑셀(XLS)</OPTION>
						</SELECT><BR>
					</div>
					<div data-role="fieldcontain"> 
					&lang=<INPUT TYPE=TEXT NAME='lang' VALUE="ko" SIZE="35"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&resourceId=<INPUT TYPE=TEXT NAME='resourceId' VALUE="bundle.properties" SIZE="35"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&propertyKey=<INPUT TYPE=TEXT NAME='propertyKey' VALUE="hello" SIZE="35"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&COL_name=<INPUT TYPE=TEXT NAME='COL_name' VALUE="QTI Guy" SIZE="35"><BR>
					</div>
					 <button id="btn">서비스 요청</button>
				</FORM>
			</LI>
			<P>
			<LI><B>Result :</B> <div id="result"></div></LI>
			<P>
		</UL>
		</div>
	</div>
</BODY>
</HTML>
