<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		
		<!--  jQuery Mobile 1.3.2 CDN -->
		<link rel="stylesheet" href="../html5/jqm/1.3.2/css/themes/default/jquery.mobile-1.3.2.min.css" />
		<script src="../html5/jq/jquery-1.9.1.min.js"></script>
		<script src="../html5/elastic-util-1.5.js"></script>
		
		<!-- 
			jQuery mobile의 event 관련 초기화 코드는 항상 여기에 둔다. 
			즉, jquery.js와 jquery.mobile.js 사이. 
		-->
		<script>
			// Initialization Event
			$(document).on("mobileinit", function() {
				// 페이지 기본 애니메이션 변경
				$.mobile.defaultPageTransition = "flow";
				// 다이얼로그 기본 애니메이션 변경
				$.mobile.defaultDialogTransition = "turn";
				// ajax 사용 여부
				$.mobile.ajaxEnabled = true;
				
				/*
					터치 이벤트
					tap: 눌렀을 때
				 */
				 $(document).on("tap", "#btn", function(e) {
					    var postData = $("#form1").serializeArray();
						$.ajax({
							// 접속할 페이지의 주소
					        url : elastic_baseUrl(),
							// 전송타입(post, get)
					        type: "GET",
							// 수신 데이터 타입(text, html, xml, json)
							dataType: "html",
							// 데이터
					        data : postData,
							// 통신이 성공하면 호출되는 함수
							success: function(resData) {
								$('#result').html("<button onClick=\"$('#result').html('')\">Clear Result</button><xmp>" + resData + "</xmp>");
							},
							// 통신이 실패하면 호출되는 함수
							error: function(error) {
								$('#result').html("error: " + error.code);
							}
						})
						e.preventDefault(); //STOP default action
					    e.unbind(); //unbind. to stop multiple form submit.
					});
			});
		</script>
		
		<script src="../html5/jqm/1.3.2/js/jquery.mobile-1.3.2.min.js"></script>
</head>
<BODY onload="loadSrc()">
	<div data-role="page">
		<div data-role="header">
			<h1>트랜잭션 걸고 두 개의 DB 쿼리 수행 후 결과 받기</h1>
			<a href="javascript:window.history.go(-1)" data-theme="a" data-ajax="false">Home</a>
		</div>
		
		<div data-role="content">
		<H3>개발자가 직접 개발할 경우</H3>
		<UL>
			<LI><B>Scala 프로그램 작성 :</B> sample.elasticservice.service.Sample03_TransactionQueryService.scala<BR>
				<pre><div id="src"></div></pre>
			</LI>
			<P>
			<LI><B>DB 쿼리문 등록 :</B> esConfig/sqlrepo/sample/sql1.xml<BR>
				<pre><div id="sql1"></div></pre>
			</LI>
			<LI><B>DB 쿼리문 등록 :</B> esConfig/sqlrepo/sample/sql2.xml<BR>
				<pre><div id="sql2"></div></pre>
			</LI>
			<P>
			<LI>
				<FORM METHOD="GET" ID="form1">
					<B>주소 :</B> <script>document.write(elastic_baseUrl())</script><BR>
					<div data-role="fieldcontain"> 
					?cmd=<INPUT TYPE=TEXT NAME='cmd' VALUE="sample.elasticservice.service.Sample03_TransactionQueryService"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&cmd.resType=<SELECT NAME="cmd.resType">
						<OPTION VALUE="ME20">MakeElastic(ME20)</OPTION>
						<OPTION VALUE="PlatformXml">XML</OPTION>
						<OPTION VALUE="PWPLUS10">PWPLUS10</OPTION>
						<OPTION VALUE="PWPLUS15">PWPLUS15</OPTION>
						<OPTION VALUE="JSON10">JSON10</OPTION>
						<OPTION VALUE="JSON11">JSON11</OPTION>
						<OPTION VALUE="JSON12" selected>JSON12</OPTION>
						<OPTION VALUE="CSV">엑셀(XLS)</OPTION>
						</SELECT><BR>
					</div>
					<div data-role="fieldcontain"> 
					&S1COL_AAA=<INPUT TYPE=TEXT NAME='S1COL_AAA' VALUE="111"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&S1COL_BBB=<INPUT TYPE=TEXT NAME='S1COL_BBB' VALUE="222"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&S2COL_AAA=<INPUT TYPE=TEXT NAME='S2COL_AAA' VALUE="111"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&S2COL_BBB=<INPUT TYPE=TEXT NAME='S2COL_BBB' VALUE="222"><BR>
					</div>
					<div data-role="fieldcontain"> 
					&S2COL_CCC=<INPUT TYPE=TEXT NAME='S2COL_CCC' VALUE="333"><BR>
					</div>
					 <button id="btn">서비스 요청</button>
				</FORM>
			</LI>
			<P>
			<LI><B>Result :</B> <div id="result"></div></LI>
		</UL>
		<br><br>
		<HR>
		<br><br>
		<H3>기본 내장 서비스 QueryService를 사용할 경우</H3>
		<UL>
			<LI><a href="javascript:elastic_go('cmd=elasticservice.service.QueryService&cmd.resType=JSON12&sqlId=sample.sql1,sample.sql2&t=true&S1COL_AAA=111&S1COL_BBB=222&S2COL_AAA=111&S2COL_BBB=222&S2COL_CCC=333')" data-ajax="false">
				<script>document.write(elastic_baseUrl())</script>?cmd=elasticservice.service.QueryService&cmd.resType=JSON12&sqlId=sample.sql1,sample.sql2&t=true&S1COL_AAA=111&S1COL_BBB=222&S2COL_AAA=111&S2COL_BBB=222&S2COL_CCC=333
				</a>
			</LI>
		</UL>
		</div>
	</div>
<script type="text/javascript">
function loadSrc() {
	var ep = new ElasticParams();
	ep.setParameter("service", "sample.elasticservice.service.TextFileReaderService");
	ep.setParameter("path", "app/sample/elasticservice/service/Sample03_TransactionQueryService.scala");
	elastic_ajax(elastic_baseUrl(), ep, function(resEP) {$('#src').html(resEP.getParameter("text"))}, null, false)

	ep = new ElasticParams();
	ep.setParameter("service", "sample.elasticservice.service.TextFileReaderService");
	ep.setParameter("path", "esConfig/sqlrepo/sample/sql1.xml");
	elastic_ajax(elastic_baseUrl(), ep, function(resEP) {$('#sql1').html(htmlEncode(resEP.getParameter("text")))}, null, false)
	
	ep = new ElasticParams();
	ep.setParameter("service", "sample.elasticservice.service.TextFileReaderService");
	ep.setParameter("path", "esConfig/sqlrepo/sample/sql2.xml");
	elastic_ajax(elastic_baseUrl(), ep, function(resEP) {$('#sql2').html(htmlEncode(resEP.getParameter("text")))}, null, false)
}
</script>
</BODY>
</HTML>
