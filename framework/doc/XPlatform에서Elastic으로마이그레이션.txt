환경공단 INAIR 프로젝트 자바소스 마이그레이션 내역

작성일: 2014년 2월 27일, 이재희


1. 개요
기존의 XPlatform 관련 자원과 설정을 모두 제거하고 Elastic Server API로 대체하였습니다.
참고로 Elastic Server는 다음 같은 순서로 서비스를 가동합니다.

    1) web.xml의 설정에 의해 컨텍스트 파라미터 elasticHome가 정의되고 ServletContextListener인 kr.co.qtii.elastic.util.ElasticConfigListener 실행
    2) elasticHome의 하부에 있는 elastic.xml 로딩
    3) elastic.xml에 설정된 config/log4j.xml, config/bean-elastic-web.xml 로딩
    

2. 작업내역
o WEB-INF/lib/xplatform-xapi-1.1.jar 삭제

o WEB-INF/lib/xplatform9-ajax-1.3.jar 삭제

o WEB-INF/lib/xplatform9-exportexcel-1.0.jar 삭제

o WEB-INF/web.xml에서 XPlatform 설정 관련된 아래 사항들을 삭제
	<!-- xplatform9 설정 Start-->
	<!-- <servlet>
      <servlet-name>AjaxCompile</servlet-name>
      <servlet-class>com.tobesoft.xplatform.console.AjaxCompileServlet</servlet-class>
      <init-param>
          <param-name>streamLog</param-name>
          <param-value>false</param-value>
      </init-param>
      <init-param>
          <param-name>elapsedTime</param-name>
          <param-value>false</param-value>
      </init-param>
    </servlet>
    <servlet-mapping>
        <servlet-name>AjaxCompile</servlet-name>
        <url-pattern>/services/AjaxCompile</url-pattern>
    </servlet-mapping>-->

    <servlet>
        <servlet-name>ForwardRequest</servlet-name>
        <servlet-class>com.tobesoft.xplatform.console.services.ForwardRequestServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>ForwardRequest</servlet-name>
        <url-pattern>/services/ForwardRequest</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>LoadResource</servlet-name>
        <servlet-class>com.tobesoft.xplatform.console.services.LoadResourceServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>LoadResource</servlet-name>
        <url-pattern>/resources/*</url-pattern>
    </servlet-mapping>

    <!-- 엑셀익스포트 요청을 처리합니다 xplatform9-ajax-exportexcel.jar 가 필요합니다. -->
    <servlet>
        <servlet-name>ExportExcel</servlet-name>
        <servlet-class>com.tobesoft.xplatform.console.services.exportexcel.ExportExcelServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>ExportExcel</servlet-name>
        <url-pattern>/services/ExportExcel</url-pattern>
    </servlet-mapping>

    <!--  ImageFilter 사용 -->
    <!-- ><servlet>
        <servlet-name>ImageFilter</servlet-name>
        <servlet-class>com.tobesoft.xplatform.console.services.imagefilter.ImageFilterServlet</servlet-class>
        <init-param>
            <param-name>cacheDir</param-name>
            <param-value>cache/images</param-value>
        </init-param>
        <init-param>
            <param-name>useCache</param-name>
            <param-value>true</param-value>
        </init-param>
    </servlet>
    <servlet-mapping>
        <servlet-name>ImageFilter</servlet-name>
        <url-pattern>/services/ImageFilter</url-pattern>
    </servlet-mapping>-->
	<!-- xplatform9 설정 End -->

o WEB-INF/u3-xp-servlet.xml에서 requestFilterInterceptor 부분을 아래와 같이 주석 처리.
    <bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping">
        <property name="interceptors">
            <list>
<!--
                <ref bean="accessLogInterceptor" />
                <ref bean="requestFilterInterceptor" />
-->
            </list>
        </property>
    </bean>

o WEB-INF/lib/elastic-1.0.1.jar 추가

o WEB-INF/lib/jaxen-1.1.1.jar 추가

o WEB-INF/lib/simple-4.1.21.jar 추가

o WEB-INF/web.xml에 추가
	<!-- 
		Elastic 설정 시작 
		2014-02-24
	-->
	<context-param>
		<param-name>elasticHome</param-name>
		<param-value>WEB-INF</param-value>
	</context-param>

	<listener>
		<listener-class>kr.co.qtii.elastic.util.ElasticConfigListener</listener-class>
	</listener>
	<!-- Elastic 설정 완료 -->

o WEB-INF/elastic.xml 추가

o WEB-INF/config/bean-elastic-web.xml 추가

o WEB-INF/config/errorCodes.err 추가

o WEB-INF/classes/log4j.xml(소스: src/main/resources/log4j.xml)을 -> src/main/webapp/WEB-INF/config/log4j.xml 이동

o com.u3cnc.common.util.xplatform.PlatformDataTypeMap.java 추가

o 다음의 소스들에서  아래 예제와 같이 '추가라인' 부분을 추가
    . com/u3cnc/common/util/xplatform/XPlatformResponseDataSetView.java
    . com/u3cnc/common/util/xplatform/XPlatformResponseMap2XMLView.java
    . com/u3cnc/common/util/xplatform/XPlatformResponseXMLView.java

    Ex)
	protected void renderMergedOutputModel(Map<String, Object> model,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {

		PlatformData o_xpData = new PlatformData();
		o_xpData.setResponseInfos(request); // 추가라인
		o_xpData.setTypeMap(new PlatformDataTypeMap()); // 추가라인


이상.


---

o 이것은 작업에서 제외 !!!!!! 
WEB-INF/u3-xp-servlet.xml에서 elasticReqInterceptor 부분을 아래와 같이 추가.
    <bean id="elasticReqInterceptor" class="kr.co.qtii.elastic.web.server.springframework.MvcRequestInterceptor" />

    <bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping">
        <property name="interceptors">
            <list>
<!--
                <ref bean="accessLogInterceptor" />
                <ref bean="requestFilterInterceptor" />
-->
                <ref bean="elasticReqInterceptor" />
            </list>
        </property>
    </bean>

o kr.or.inair.dtse.controller.DtSeMsAtController
for 조건문에 codes != null 추가

	private List<String> getCmmnNm(HashMap<String, String> inItemMap,
			List<String> codes) {
		List<String> temp = new ArrayList<String>();
		for (int i = 0; codes != null && i < codes.size(); i++) {
			temp.add(inItemMap.get(codes.get(i)));
		}
		return temp;
	}

