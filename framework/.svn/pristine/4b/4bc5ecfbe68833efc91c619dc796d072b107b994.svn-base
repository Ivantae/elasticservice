package scalacheck.elasticservice.util.ep

import org.scalacheck.Prop.BooleanOperators
import org.scalacheck.Prop.forAll
import org.scalacheck.Properties
import elasticservice.epMkString
import elasticservice.util.ep.ColumnInfo
import elasticservice.util.ep.Dataset
import scalacheck._
import org.scalacheck.Gen

object DatasetTest extends Properties("Dataset") {
  property("apply1") = forAll (Gen.alphaStr, Gen.listOf(genColumnInfo)) { 
  	(name: String, colInfos: List[ColumnInfo]) =>
  		val ds = Dataset(name, colInfos)
  		
  		("name" |: ds.name == name) &&
  		("_colInfos" |: ds._colInfos == colInfos)
  }
  
  property("addColInfo") = forAll { (name: String, ci: ColumnInfo) =>
  	val ds = Dataset(name)
		ds.addColInfo(ci)
		
		val cis = ds.colInfos
		
		ds.colInfo(cis.size - 1) == ci
  }
  
  property("rows_=") = forAll { (ds: Dataset, ls: List[Map[String, AnyVal]]) =>
		ds.rows_=(ls)
		
		ds.nrOfRowss == ls.size
  }
  
  property("+=(row: Map[String, Any])") = forAll { (ds: Dataset, m: Map[String, AnyVal]) =>
  	val originRowsCount = ds.nrOfRowss
  	
		ds += m
		
		ds.nrOfRowss == originRowsCount + 1
  }
  
  property("+=(colId: String, value: Any)") = forAll { (ds: Dataset, colId: String, value: AnyVal) =>
		ds += (colId, value)
		ds.rows.exists { x => x.exists { case (k, v) => k == colId && v == value } }
  }
}